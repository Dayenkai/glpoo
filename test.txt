de norton ou avec norton
titre Le Roi des Singes ou le roi des singes, pays cn
titre le roi des singes, en 1965
titre Judou ou titre Printemps tardif

import java.sql.*;
import java.util.ArrayList;
import java.util.Arrays;

public class RunInfofilmTest {
    private Connection c;

    public Connection getC() {
        return this.c;
    }

    public void setC(Connection c) {
       this.c = c;
    }

    //CONSTRUCTEUR OUVERTURE DE LA CONNECTION A LA BASE DE DONNEES

    public RunInfofilmTest(String nomFichierSqlite) {

        this.setC(null);
        try {
            Class.forName("org.sqlite.JDBC");
            this.setC(DriverManager.getConnection("jdbc:sqlite:" + nomFichierSqlite));
        } catch (Exception e) {
            System.err.println(e.getClass().getName() + ": " + e.getMessage());
            System.exit(0);
        }
        System.out.println("Opened database successfully");
    }


    //FERME LA BASE DE DONNEES
    public void fermeBase() {
        try{
            if(this.getC() != null){
                this.getC().close();
            }

        }catch(SQLException se){
            se.printStackTrace();
        }
        System.out.println("Closed database successfully");
    }

    public void create_json(String sql_statement) {

        String final_ = "{\"resultat\"";
        ArrayList<NomPersonne> info_al_real=new ArrayList<>();
        ArrayList<NomPersonne> info_al_act=new ArrayList<>();
        ArrayList<String> info_al_autres_titres=new ArrayList<>();
        String info_titre=null;
        String info_nom;
        String info_prenom;
        int info_annee=0;
        int info_duree=0;
        String info_pays="";
        int cpt=0;
        int filmcpt=0;
        NomPersonne info_np= new NomPersonne("","");

        RunInfofilmTest rf = new RunInfofilmTest("C:\\Users\\kgeor\\Desktop\\Dev\\SQLite\\bdfilm.sqlite");

        try{

            rf.getC().setAutoCommit(false);
            Statement stmt = rf.getC().createStatement();
            ResultSet rst = stmt.executeQuery(sql_statement);

            while(rst.next()){
                if (info_titre!=null && !(rst.getString("TITRE").equals(info_titre))) {
                    InfoFilm if_res = new InfoFilm(info_titre,info_al_real,info_al_act,info_pays, info_annee, info_duree, info_al_autres_titres);
                    final_ = final_ + "\n" + if_res.toString();

                    info_al_real = new ArrayList<>();
                    info_al_act = new ArrayList<>();
                    info_al_autres_titres = new ArrayList<>();
                    cpt = 0;
                    filmcpt++;

                    if(filmcpt==100) {
                        break;
                    } else {
                        final_ += ",";
                    }
                }

                String g_titre = rst.getString("TITRE");
                int g_annee = rst.getInt("ANNEE");
                String g_role = rst.getString("ROLE");
                String g_pays = rst.getString("COUNTRY");
                int g_duree = rst.getInt("DUREE");
                String g_autres_titres = rst.getString("AUTRES_TITRES");
                String g_prenom = "";
                String g_nom = "";



                info_titre=g_titre;
                info_annee=g_annee;
                info_duree=g_duree;
                info_pays=g_pays;
                info_al_autres_titres.add(g_autres_titres);

                if(!rst.getString("NOM").equals(null))
                    g_nom = rst.getString("NOM");

                if(!rst.getString("PRENOM").equals(null))
                    g_prenom = rst.getString("PRENOM");


                info_nom=g_nom;
                info_prenom=g_prenom;

                info_np = new NomPersonne(info_nom, info_prenom);

                if(g_role.equals("A"))
                    info_al_act.add(info_np);

                if(g_role.equals("R"))
                    info_al_real.add(info_np);

                if(rst.getString("AUTRES_TITRES")!=null) {
                    String[] part = rst.getString("AUTRES_TITRES").split("%");
                    ArrayList<String> ppart= new ArrayList<>(Arrays.asList(part));

                    for(int i=0;i<ppart.size();i++) {

                        if(cpt==0) {
                            info_al_autres_titres.add(ppart.get(i));
                        }
                    }
                    cpt++;
                }

            }


            if((info_titre!=null)&&(filmcpt!=100)) {
                InfoFilm if_res = new InfoFilm(info_titre,info_al_real,info_al_act,info_pays, info_annee, info_duree, info_al_autres_titres);
                filmcpt++;
                final_ = final_ + "\n" + if_res.toString();
            }

            if(filmcpt==100) {
                final_+="],\"info\" 100 RESULTAT MAX \"}";
            } else {
                final_+= "]}";
            }

            System.out.println(final_);

        }catch(SQLException e) {
            System.out.println(e.getMessage());
        }

    }

    public static void main(String[] args) {
        String sqlstatement = "with filtre as (select id_film from recherche_titre where titre match \"histoire\")\n" +
                "select F.titre,F.annee, F.duree, group_concat(A.titre, '|') as autres_titres,P.prenom, P.nom, G.role, Py.nom as country from filtre\n" +
                "                                                                                                              join films f on F.id_film = filtre.id_film\n" +
                "                                                                                                              join pays py on Py.code = F.pays\n" +
                "                                                                                                              left join autres_titres a on A.id_film = F.id_film\n" +
                "                                                                                                              join generique g on G.id_film = F.id_film\n" +
                "                                                                                                              join personnes p on P.id_personne = G.id_personne\n" +
                "group by F.titre,F.annee, F.duree, P.prenom, P.nom, G.role, F.pays";

    RunInfofilmTest rt =new RunInfofilmTest("C:\\Users\\kgeor\\Desktop\\Dev\\SQLite\\bdfilm.sqlite");
    rt.create_json(sqlstatement);
       
    }
}